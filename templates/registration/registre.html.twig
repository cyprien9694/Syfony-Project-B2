<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inscription - Sky of Tonight</title>

    {% block stylesheets %}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    <link rel="stylesheet" href="{{ asset('css/registre.css') }}">
    {% endblock %}

</head>

<body>
    <div class="register-container">
        <div class="register-card">
            <div class="star-title">
                <h1> Sky of Tonight</h1>
            </div>

            {# Messages flash #}
            {% for label, messages in app.flashes %}
            {% for message in messages %}
            <div class="alert alert-{{ label }}">
                <i class="fas fa-{{ label == 'success' ? 'check-circle' : 'exclamation-triangle' }}"></i>
                {{ message }}
            </div>
            {% endfor %}
            {% endfor %}

            {{ form_start(registrationForm, {'attr': {'id': 'register-form'}}) }}
            <div class="form-group">
                {{ form_label(registrationForm.email, 'Email', {'label_attr': {'class': 'form-label'}}) }}
                {{ form_widget(registrationForm.email, {
                'attr': {
                'class': 'form-control',
                'placeholder': 'votre@email.com',
                'autocomplete': 'email'
                }
                }) }}
                {{ form_errors(registrationForm.email) }}
            </div>

            <div class="form-group">
                {{ form_label(registrationForm.plainPassword.first, 'Mot de passe', {'label_attr': {'class':
                'form-label'}}) }}
                {{ form_widget(registrationForm.plainPassword.first, {
                'attr': {
                'class': 'form-control',
                'placeholder': '••••••••',
                'autocomplete': 'new-password'
                }
                }) }}
                <div id="password-strength" class="password-strength"></div>
                {{ form_errors(registrationForm.plainPassword.first) }}
            </div>

            <div class="form-group">
                {{ form_label(registrationForm.plainPassword.second, 'Confirmer le mot de passe', {'label_attr':
                {'class': 'form-label'}}) }}
                {{ form_widget(registrationForm.plainPassword.second, {
                'attr': {
                'class': 'form-control',
                'placeholder': '••••••••',
                'autocomplete': 'new-password'
                }
                }) }}
                {{ form_errors(registrationForm.plainPassword.second) }}
            </div>

            <button type="submit" class="btn-register" id="submit-btn">
                <i class="fas fa-user-plus"></i> S'inscrire
            </button>
            {{ form_end(registrationForm) }}

            <div class="register-links">
                <p style="margin-bottom: 10px;">
                    Déjà un compte ?
                    <a href="{{ path('app_login') }}">Se connecter</a>
                </p>
                <p style="margin: 0;">
                    <a href="{{ path('app_home') }}">
                        <i class="fas fa-home"></i> Retour à l'accueil
                    </a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Validation du mot de passe en temps réel
        document.addEventListener('DOMContentLoaded', function () {
            const passwordInput = document.querySelector('#{{ registrationForm.plainPassword.first.vars.id }}');
            const confirmInput = document.querySelector('#{{ registrationForm.plainPassword.second.vars.id }}');
            const strengthText = document.getElementById('password-strength');
            const submitBtn = document.getElementById('submit-btn');

            function checkPasswordStrength(password) {
                let strength = 0;
                let text = '';
                let className = '';

                if (password.length >= 8) strength++;
                if (/[A-Z]/.test(password)) strength++;
                if (/[0-9]/.test(password)) strength++;
                if (/[^A-Za-z0-9]/.test(password)) strength++;

                switch (strength) {
                    case 0:
                    case 1:
                        text = 'Faible';
                        className = 'strength-weak';
                        break;
                    case 2:
                    case 3:
                        text = 'Moyen';
                        className = 'strength-medium';
                        break;
                    case 4:
                        text = 'Fort';
                        className = 'strength-strong';
                        break;
                }

                return { text, className };
            }

            function validatePasswords() {
                const password = passwordInput.value;
                const confirm = confirmInput.value;

                // Force du mot de passe
                if (password) {
                    const strength = checkPasswordStrength(password);
                    strengthText.textContent = `Force : ${strength.text}`;
                    strengthText.className = `password-strength ${strength.className}`;
                } else {
                    strengthText.textContent = '';
                }

                // Vérification de correspondance
                if (password && confirm) {
                    if (password !== confirm) {
                        confirmInput.style.borderColor = '#dc3545';
                        submitBtn.disabled = true;
                        submitBtn.style.opacity = '0.6';
                    } else {
                        confirmInput.style.borderColor = '#28a745';
                        submitBtn.disabled = false;
                        submitBtn.style.opacity = '1';
                    }
                } else {
                    confirmInput.style.borderColor = '#e0e0e0';
                    submitBtn.disabled = false;
                    submitBtn.style.opacity = '1';
                }
            }

            if (passwordInput && confirmInput) {
                passwordInput.addEventListener('input', validatePasswords);
                confirmInput.addEventListener('input', validatePasswords);
            }

            // Initial validation
            validatePasswords();
        });
    </script>
</body>

</html>