{% extends 'base.html.twig' %}

{% block title %}Liste des Ã©toiles
{% endblock %}

{% block stylesheets %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
<link rel="stylesheet" href="{{ asset('css/star.css') }}">
{% endblock %}

{% block javascripts %}
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="{{ asset('js/Filtre.js') }}" defer></script>
<script src="{{ asset('js/audio.js') }}" defer></script>
{% endblock %}

{% block body %}
<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
	<div class="container-fluid">
		<a class="navbar-brand fw-bold" href="{{ path('app_home') }}">â­ Liste des Ã©toiles</a>
		<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarMain">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarMain">
			<ul class="navbar-nav ms-auto">
				<li class="nav-item">
					<a class="nav-link" href="{{ path('app_home') }}">ğŸ  Accueil</a>
				</li>
				<li class="nav-item">
					<a class="nav-link active" href="{{ path('app_star') }}">â­ Ã‰toiles</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="{{ path('app_star_day') }}">ğŸŒŸ Ã‰toile du jour</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="{{ path('app_contact') }}">â„¹ï¸ Contact</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" href="{{ path('app_comment') }}">ğŸ’¬ Commentaires</a>
				</li>
				<ul class="navbar-nav">
					{% if app.user %}
					<li class="nav-item">
						<div class="d-flex align-items-center">
							<span class="text-primary me-2">
								<i class="fas fa-user-circle"></i> {{ app.user.email|slice(0, 20) }}{{
								app.user.email|length > 20 ? '...' : '' }}
							</span>
							<a class="nav-link" href="{{ path('app_logout') }}">ğŸšª Se dÃ©connecter</a>
						</div>
					</li>
					{% endif %}
				</ul>
			</ul>
		</div>
	</div>
</nav>

{# Messages flash #}
{% for label, messages in app.flashes %}
{% for message in messages %}
<div class="flash-{{ label }}">{{ message }}</div>
{% endfor %}
{% endfor %}

<!-- CONTENU PRINCIPAL -->
<main class="container content">

	<!-- HEADER PAGE -->
	<div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-3">
		<h2 class="page-title">ğŸŒŸ Nos Ã©toiles</h2>
		{% if isAdmin %}
		<a href="{{ path('star_new') }}" class="btn btn-primary ">
			<i class="fa-solid fa-plus"></i>
			<span class="d-none d-md-inline ms-2">Ajouter une Ã©toile</span>
		</a>
		{% endif %}
	</div>

	<!-- FILTRE -->
	<form method="get" action="{{ path('app_star') }}"
		class="filtre-form d-flex align-items-center gap-2 mb-4 flex-wrap">
		<select name="category" class="form-select">
			<option class="categories" value="all">Toutes les catÃ©gories</option>
			{% for category in categories %}
			<option class="categories" value="{{ category.id }}" {% if selectedCategory==category.id %}selected{% endif
				%}>
				{{ category.name }}
			</option>
			{% endfor %}
		</select>
		<button type="submit" class="btn btn-outline-primary">
			<i class="fas fa-filter"></i> Filtrer
		</button>
	</form>

	<!-- GRID DES CARDS -->
	<div class="row">
		{% for star in stars %}
		<div class="col-6 col-md-4 col-lg-3 mb-4">
			<div class="star-card position-relative d-flex flex-column h-100">

				<div class="image-center">
					<img src="{{ star.image }}" alt="{{ star.name }}" class="image">
					<a href="{{ path('star_show', {'id': star.id}) }}" class="stretched-link"></a>
				</div>


				<div class="card-body text-center">
					<h5 class="card-title">{{ star.name }}</h5>

					<div class="d-flex justify-center gap-2 mt-2">
						{% if app.user %}
						{% if isAdmin %}
						{# ğŸ‘‘ ADMIN: see all buttons #}
						<a href="{{ path('star_edit', {'id': star.id}) }}"
							class="btn btn-filter d-flex align-items-center justify-content-center">
							<i class="fa-solid fa-pen"></i>
							<span class="d-none d-md-inline ms-2">Modifier</span>
						</a>

						<form method="post" action="{{ path('star_delete', {'id': star.id}) }}"
							onsubmit="return confirm('âš ï¸ Supprimer cette Ã©toile ?');" style="display:inline-block">
							<input type="hidden" name="_token" value="{{ csrf_token('delete' ~ star.id) }}">
							<button type="submit"
								class="btn btn-filter d-flex align-items-center justify-content-center">
								<i class="fa-solid fa-trash"></i>
								<span class="d-none d-md-inline ms-2">Supprimer</span>
							</button>
						</form>

						{% endif %}
						{% endif %}
					</div>

				</div>
			</div>
		</div>
		{% else %}
		<p class="text-center text-danger">Aucune Ã©toile trouvÃ©e ğŸŒŒ</p>
		{% endfor %}
	</div>

</main>
{% endblock %}